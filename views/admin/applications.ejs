<!-- views/admin/applications.ejs -->
<%- include('../header.ejs') %>

<br><br><br><br>

<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3>All Applications</h3>
    <div>
      <a class="btn btn-outline-secondary" href="/admin/dashboard">Dashboard</a>
      <a class="btn btn-danger ms-2" href="/admin/logout">Logout</a>
    </div>
  </div>

  <% if (applications && applications.length) { %>
    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>User</th>
            <th>Course</th>
            <th>College</th>
            <th>Branch</th>
            <th>Status</th>
            <th>Comment</th>
            <th>Applied At</th>
          </tr>
        </thead>

        <tbody>
          <% applications.forEach(function(app, i) { %>
            <tr>
              <td><%= i + 1 %></td>
              <td><%= app.name %></td>
              <td><%= app.user ? app.user.name : '-' %></td>

              <td>
                <%= (app.course && app.course.name)
                    ? app.course.name
                    : (typeof app.course === 'string' ? app.course : '-') %>
              </td>

              <td><%= app.college %></td>
              <td><%= app.branch %></td>

              <!-- Status + Comment Form -->
              <td colspan="2">
                <form action="/admin/application/<%= app._id %>/status" method="post" class="d-flex gap-1">
                  
                  <select name="status" class="form-select form-select-sm" style="width:120px">
                    <option value="pending"  <%= app.status === 'pending' ? 'selected' : '' %>>Pending</option>
                    <option value="approved" <%= app.status === 'approved' ? 'selected' : '' %>>Approved</option>
                    <option value="rejected" <%= app.status === 'rejected' ? 'selected' : '' %>>Rejected</option>
                  </select>

                  <input type="text"
                    name="comment"
                    placeholder="Comment"
                    value="<%= app.comment || '' %>"
                    class="form-control form-control-sm"
                    style="max-width:180px" />

                  <button class="btn btn-sm btn-primary" type="submit">Save</button>
                </form>
              </td>

              <td><%= new Date(app.createdAt).toLocaleString() %></td>
            </tr>
          <% }) %>
        </tbody>

      </table>
    </div>
  <% } else { %>
    <p class="text-muted">No applications found.</p>
  <% } %>
</div>

<%- include('../footer.ejs') %>
